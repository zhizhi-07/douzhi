<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ°”æ³¡åˆ‡å›¾å·¥å…· - ä¹å®«æ ¼åˆ‡ç‰‡ + ä¼ªå…ƒç´ è´´çº¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 20px;
    }
    
    .panel {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .panel h2 {
      font-size: 18px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #007AFF;
    }
    
    .section {
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .section:last-child {
      border-bottom: none;
    }
    
    .section h3 {
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
      font-weight: 600;
    }
    
    .upload-area {
      border: 2px dashed #ccc;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .upload-area:hover {
      border-color: #007AFF;
      background: #f0f8ff;
    }
    
    .upload-area input {
      display: none;
    }
    
    .slice-control {
      margin-bottom: 12px;
    }
    
    .slice-control label {
      display: block;
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
    }
    
    .slice-control input[type="range"] {
      width: 100%;
      height: 4px;
      border-radius: 2px;
      outline: none;
      -webkit-appearance: none;
      background: #ddd;
    }
    
    .slice-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #007AFF;
      cursor: pointer;
    }
    
    .value-display {
      display: inline-block;
      min-width: 40px;
      text-align: right;
      font-weight: 600;
      color: #007AFF;
    }
    
    .preview-area {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 40px;
      min-height: 500px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .preview-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 10px;
    }
    
    .slice-preview {
      position: relative;
      margin-bottom: 30px;
    }
    
    .slice-preview img {
      max-width: 100%;
      display: block;
      border: 1px solid #ddd;
    }
    
    .slice-lines {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    .bubble-preview {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .message-bubble {
      padding: 12px 16px;
      max-width: 70%;
      word-wrap: break-word;
      position: relative;
    }
    
    .message-bubble.sent {
      align-self: flex-end;
      background: #007AFF;
      color: white;
    }
    
    .message-bubble.received {
      align-self: flex-start;
      background: #E5E5EA;
      color: black;
    }
    
    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: #007AFF;
      color: white;
    }
    
    .btn-primary:hover {
      background: #0056b3;
    }
    
    .btn-secondary {
      background: #34C759;
      color: white;
      margin-top: 10px;
    }
    
    .btn-secondary:hover {
      background: #28a745;
    }
    
    .sticker-control {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-top: 12px;
    }
    
    .control-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .control-row label {
      font-size: 11px;
      color: #666;
      margin-bottom: 4px;
      display: block;
    }
    
    .control-row input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
    }
    
    .sticker-preview {
      margin-top: 10px;
      padding: 10px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 11px;
      overflow-x: auto;
    }
    
    .code-output {
      background: #282c34;
      color: #abb2bf;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre;
    }
    
    .copy-btn {
      margin-top: 10px;
      background: #FF9500;
      color: white;
    }
    
    .copy-btn:hover {
      background: #e68600;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .tab {
      padding: 8px 16px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s;
    }
    
    .tab.active {
      background: #007AFF;
      color: white;
      border-color: #007AFF;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
    <div class="panel">
      <h2>ğŸ¨ æ°”æ³¡åˆ‡å›¾å·¥å…·</h2>
      
      <!-- 1. ä¸Šä¼ å›¾ç‰‡ -->
      <div class="section">
        <h3>ğŸ“¤ ä¸Šä¼ æ°”æ³¡åº•å›¾</h3>
        <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
          <input type="file" id="imageUpload" accept="image/*">
          <div>ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</div>
          <div style="font-size:11px; color:#999; margin-top:8px;">æ”¯æŒ PNG, JPG, SVG</div>
        </div>
        <div id="imageInfo" style="margin-top:10px; font-size:11px; color:#666;"></div>
      </div>
      
      <!-- 2. ä¹å®«æ ¼åˆ‡ç‰‡ -->
      <div class="section">
        <h3>âœ‚ï¸ ä¹å®«æ ¼åˆ‡ç‰‡ä½ç½®</h3>
        <div class="slice-control">
          <label>ä¸Š (Top): <span class="value-display" id="topVal">30</span>px</label>
          <input type="range" id="sliceTop" min="0" max="200" value="30">
        </div>
        <div class="slice-control">
          <label>å³ (Right): <span class="value-display" id="rightVal">30</span>px</label>
          <input type="range" id="sliceRight" min="0" max="200" value="30">
        </div>
        <div class="slice-control">
          <label>ä¸‹ (Bottom): <span class="value-display" id="bottomVal">30</span>px</label>
          <input type="range" id="sliceBottom" min="0" max="200" value="30">
        </div>
        <div class="slice-control">
          <label>å·¦ (Left): <span class="value-display" id="leftVal">30</span>px</label>
          <input type="range" id="sliceLeft" min="0" max="200" value="30">
        </div>
      </div>
      
      <!-- 3. è¾¹æ¡†å®½åº¦ -->
      <div class="section">
        <h3>ğŸ“ è¾¹æ¡†æ¸²æŸ“å®½åº¦</h3>
        <div class="slice-control">
          <label>å®½åº¦: <span class="value-display" id="widthVal">20</span>px</label>
          <input type="range" id="borderWidth" min="5" max="80" value="20">
        </div>
      </div>
      
      <!-- 4. åŸºç¡€æ ·å¼è°ƒæ•´ -->
      <div class="section">
        <h3>âš™ï¸ åŸºç¡€æ ·å¼</h3>
        
        <div class="slice-control">
          <label>å†…è¾¹è·: <span class="value-display" id="paddingVal">12</span>px</label>
          <input type="range" id="padding" min="0" max="40" value="12">
        </div>
        
        <div class="slice-control">
          <label>æœ€å¤§å®½åº¦: <span class="value-display" id="maxWidthVal">70</span>%</label>
          <input type="range" id="maxWidth" min="30" max="100" value="70">
        </div>
        
        <div class="slice-control">
          <label>æœ€å°å®½åº¦: <span class="value-display" id="minWidthVal">0</span>px</label>
          <input type="range" id="minWidth" min="0" max="200" value="0">
        </div>
        
        <div class="slice-control">
          <label>å®½åº¦æ¨¡å¼:</label>
          <select id="widthMode" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
            <option value="auto" selected>è‡ªåŠ¨ (æ¨è)</option>
            <option value="fixed-min">å›ºå®šæœ€å°å®½åº¦</option>
          </select>
        </div>
        
        <div class="slice-control">
          <label>åœ†è§’: <span class="value-display" id="radiusVal">0</span>px</label>
          <input type="range" id="borderRadius" min="0" max="30" value="0">
        </div>
        
        <div class="slice-control">
          <label>æ‹‰ä¼¸æ¨¡å¼:</label>
          <select id="repeatMode" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
            <option value="stretch">æ‹‰ä¼¸ (stretch)</option>
            <option value="repeat">é‡å¤ (repeat)</option>
            <option value="round">åœ†è§’é‡å¤ (round)</option>
            <option value="space">é—´éš” (space)</option>
          </select>
        </div>
        
        <div class="slice-control">
          <label>æ–‡å­—å¯¹é½:</label>
          <select id="textAlign" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
            <option value="left">å·¦å¯¹é½</option>
            <option value="center">å±…ä¸­</option>
            <option value="right">å³å¯¹é½</option>
          </select>
        </div>
        
        <div class="slice-control">
          <label>è¡Œé«˜: <span class="value-display" id="lineHeightVal">1.5</span></label>
          <input type="range" id="lineHeight" min="1" max="2.5" step="0.1" value="1.5">
        </div>
        
        <div class="slice-control">
          <label>å­—ä½“å¤§å°: <span class="value-display" id="fontSizeVal">14</span>px</label>
          <input type="range" id="fontSize" min="10" max="20" value="14">
        </div>
        
        <div class="slice-control">
          <label>å‚ç›´å¯¹é½:</label>
          <select id="verticalAlign" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
            <option value="baseline">åŸºçº¿å¯¹é½ (baseline)</option>
            <option value="top">é¡¶éƒ¨å¯¹é½ (top)</option>
            <option value="middle">ä¸­é—´å¯¹é½ (middle)</option>
            <option value="bottom">åº•éƒ¨å¯¹é½ (bottom)</option>
          </select>
        </div>
      </div>
      
      <!-- 4. ä¼ªå…ƒç´ è´´çº¸ -->
      <div class="section">
        <h3>ğŸ­ ä¼ªå…ƒç´ è£…é¥°ï¼ˆè´´çº¸ï¼‰</h3>
        <div class="tabs">
          <div class="tab active" onclick="switchSticker('before')">::before</div>
          <div class="tab" onclick="switchSticker('after')">::after</div>
        </div>
        
        <div id="stickerBefore" class="sticker-control">
          <label style="margin-bottom:8px; display:block;">è´´çº¸å›¾ç‰‡:</label>
          <div class="upload-area" onclick="document.getElementById('beforeUpload').click()" style="padding:20px; margin-bottom:12px;">
            <input type="file" id="beforeUpload" accept="image/*" style="display:none;">
            <div id="beforePreview" style="font-size:12px; color:#666;">ç‚¹å‡»ä¸Šä¼ è´´çº¸å›¾ç‰‡</div>
          </div>
          
          <div class="control-row">
            <div>
              <label>å®½åº¦ (width)</label>
              <input type="number" id="beforeWidth" value="60" min="10" max="300">
            </div>
            <div>
              <label>é«˜åº¦ (height)</label>
              <input type="number" id="beforeHeight" value="40" min="10" max="300">
            </div>
          </div>
          
          <div class="slice-control">
            <label>ä¸Šåç§» (top): <span class="value-display" id="beforeTopVal">-30</span>px</label>
            <input type="range" id="beforeTop" min="-200" max="200" value="-30">
          </div>
          
          <div class="slice-control">
            <label>å®šä½æ–¹å¼:</label>
            <select id="beforePosition" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
              <option value="left">ä»å·¦è¾¹ç¼˜å®šä½</option>
              <option value="right" selected>ä»å³è¾¹ç¼˜å®šä½</option>
            </select>
          </div>
          
          <div class="slice-control">
            <label>è·ç¦»è¾¹ç¼˜: <span class="value-display" id="beforeOffsetVal">20</span>px</label>
            <input type="range" id="beforeOffset" min="-50" max="200" value="20">
          </div>
          
          <div class="slice-control">
            <label>æ°´å¹³å¾®è°ƒ: <span class="value-display" id="beforeXVal">0</span>px</label>
            <input type="range" id="beforeX" min="-100" max="100" value="0">
          </div>
          
          <label style="display:flex; align-items:center; gap:6px; margin-top:10px; font-size:12px;">
            <input type="checkbox" id="beforeEnable" checked>
            å¯ç”¨ ::before è´´çº¸
          </label>
        </div>
        
        <div id="stickerAfter" class="sticker-control" style="display:none;">
          <label style="margin-bottom:8px; display:block;">è´´çº¸å›¾ç‰‡:</label>
          <div class="upload-area" onclick="document.getElementById('afterUpload').click()" style="padding:20px; margin-bottom:12px;">
            <input type="file" id="afterUpload" accept="image/*" style="display:none;">
            <div id="afterPreview" style="font-size:12px; color:#666;">ç‚¹å‡»ä¸Šä¼ è´´çº¸å›¾ç‰‡</div>
          </div>
          
          <div class="control-row">
            <div>
              <label>å®½åº¦ (width)</label>
              <input type="number" id="afterWidth" value="40" min="10" max="300">
            </div>
            <div>
              <label>é«˜åº¦ (height)</label>
              <input type="number" id="afterHeight" value="40" min="10" max="300">
            </div>
          </div>
          
          <div class="slice-control">
            <label>ä¸Šåç§» (top): <span class="value-display" id="afterTopVal">10</span>px</label>
            <input type="range" id="afterTop" min="-200" max="200" value="10">
          </div>
          
          <div class="slice-control">
            <label>å®šä½æ–¹å¼:</label>
            <select id="afterPosition" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
              <option value="left" selected>ä»å·¦è¾¹ç¼˜å®šä½</option>
              <option value="right">ä»å³è¾¹ç¼˜å®šä½</option>
            </select>
          </div>
          
          <div class="slice-control">
            <label>è·ç¦»è¾¹ç¼˜: <span class="value-display" id="afterOffsetVal">20</span>px</label>
            <input type="range" id="afterOffset" min="-50" max="200" value="20">
          </div>
          
          <div class="slice-control">
            <label>æ°´å¹³å¾®è°ƒ: <span class="value-display" id="afterXVal">0</span>px</label>
            <input type="range" id="afterX" min="-100" max="100" value="0">
          </div>
          
          <label style="display:flex; align-items:center; gap:6px; margin-top:10px; font-size:12px;">
            <input type="checkbox" id="afterEnable">
            å¯ç”¨ ::after è´´çº¸
          </label>
        </div>
      </div>
      
      <!-- ç”ŸæˆæŒ‰é’® -->
      <button class="btn btn-primary" onclick="generateCSS()">ç”Ÿæˆ CSS ä»£ç </button>
    </div>
    
    <!-- å³ä¾§é¢„è§ˆå’Œä»£ç  -->
    <div>
      <!-- åˆ‡ç‰‡é¢„è§ˆ -->
      <div class="panel" style="margin-bottom:20px;">
        <h2>ğŸ‘ï¸ åˆ‡ç‰‡é¢„è§ˆ</h2>
        <div class="slice-preview" id="slicePreview">
          <div style="text-align:center; color:#999; padding:60px 0;">è¯·å…ˆä¸Šä¼ å›¾ç‰‡</div>
        </div>
      </div>
      
      <!-- æ°”æ³¡é¢„è§ˆ -->
      <div class="panel" style="margin-bottom:20px;">
        <h2>ğŸ’¬ æ°”æ³¡æ•ˆæœé¢„è§ˆ</h2>
        <div class="bubble-preview">
          <!-- å®Œå…¨åŒ¹é…å®é™…é¡¹ç›®ç»“æ„ -->
          <div class="message-container sent" style="display:flex; align-items:flex-start; gap:8px; margin:8px 0; flex-direction:row-reverse;">
            <div class="message-bubble" id="bubbleSent" style="display:inline-block;">
              <div class="leading-relaxed" style="line-height:1.5;">çŸ­æ¶ˆæ¯æµ‹è¯•</div>
            </div>
          </div>
          
          <div class="message-container received" style="display:flex; align-items:flex-start; gap:8px; margin:8px 0; flex-direction:row;">
            <div class="message-bubble" id="bubbleReceived" style="display:inline-block;">
              <div class="leading-relaxed" style="line-height:1.5;">è¿™æ˜¯ä¸€æ¡æ¯”è¾ƒé•¿çš„æ¶ˆæ¯ï¼Œç”¨æ¥æµ‹è¯•æ°”æ³¡çš„æ¢è¡Œæ•ˆæœå’Œä¹å®«æ ¼æ‹‰ä¼¸æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºã€‚</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- CSS ä»£ç è¾“å‡º -->
      <div class="panel">
        <h2>ğŸ“‹ CSS ä»£ç </h2>
        <div class="code-output" id="cssOutput">// ç‚¹å‡»"ç”Ÿæˆ CSS ä»£ç "æŒ‰é’®</div>
        <button class="btn copy-btn" onclick="copyCSS()">ğŸ“‹ å¤åˆ¶ CSS</button>
      </div>
    </div>
  </div>

  <script>
    let imageData = {
      url: '',
      width: 0,
      height: 0
    };
    
    let sliceData = {
      top: 30,
      right: 30,
      bottom: 30,
      left: 30,
      borderWidth: 20,
      padding: 12,
      maxWidth: 70,
      minWidth: 0,
      widthMode: 'auto',
      borderRadius: 0,
      repeatMode: 'stretch',
      textAlign: 'left',
      lineHeight: 1.5,
      fontSize: 14,
      verticalAlign: 'baseline'
    };
    
    let stickerData = {
      before: {
        enabled: true,
        url: '',
        width: 60,
        height: 40,
        top: -30,
        position: 'right',  // å®šä½æ–¹å¼ï¼šleft æˆ– right
        offset: 20,  // è·ç¦»è¾¹ç¼˜çš„åƒç´ è·ç¦»
        x: 0  // é¢å¤–çš„æ°´å¹³å¾®è°ƒ
      },
      after: {
        enabled: false,
        url: '',
        width: 40,
        height: 40,
        top: 10,
        position: 'left',  // å®šä½æ–¹å¼
        offset: 20,  // è·ç¦»è¾¹ç¼˜çš„åƒç´ è·ç¦»
        x: 0  // é¢å¤–çš„æ°´å¹³å¾®è°ƒ
      }
    };
    
    // ä¸Šä¼ å›¾ç‰‡
    document.getElementById('imageUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const img = new Image();
          img.onload = function() {
            imageData.url = event.target.result;
            imageData.width = img.width;
            imageData.height = img.height;
            
            document.getElementById('imageInfo').innerHTML = 
              `âœ… å·²ä¸Šä¼ : ${img.width}Ã—${img.height}px`;
            
            updateSlicePreview();
            applyPreview(); // è‡ªåŠ¨åº”ç”¨é¢„è§ˆ
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
    
    // åˆ‡ç‰‡æ»‘å—äº‹ä»¶
    ['Top', 'Right', 'Bottom', 'Left'].forEach(dir => {
      const slider = document.getElementById('slice' + dir);
      const display = document.getElementById(dir.toLowerCase() + 'Val');
      slider.addEventListener('input', function() {
        sliceData[dir.toLowerCase()] = parseInt(this.value);
        display.textContent = this.value;
        updateSlicePreview();
        applyPreview(); // å®æ—¶æ›´æ–°é¢„è§ˆ
      });
    });
    
    // è¾¹æ¡†å®½åº¦æ»‘å—
    document.getElementById('borderWidth').addEventListener('input', function() {
      sliceData.borderWidth = parseInt(this.value);
      document.getElementById('widthVal').textContent = this.value;
      applyPreview(); // å®æ—¶æ›´æ–°é¢„è§ˆ
    });
    
    // å†…è¾¹è·æ»‘å—
    document.getElementById('padding').addEventListener('input', function() {
      sliceData.padding = parseInt(this.value);
      document.getElementById('paddingVal').textContent = this.value;
      applyPreview();
    });
    
    // æœ€å¤§å®½åº¦æ»‘å—
    document.getElementById('maxWidth').addEventListener('input', function() {
      sliceData.maxWidth = parseInt(this.value);
      document.getElementById('maxWidthVal').textContent = this.value;
      applyPreview();
    });
    
    // æœ€å°å®½åº¦æ»‘å—
    document.getElementById('minWidth').addEventListener('input', function() {
      sliceData.minWidth = parseInt(this.value);
      document.getElementById('minWidthVal').textContent = this.value;
      applyPreview();
    });
    
    // å®½åº¦æ¨¡å¼é€‰æ‹©
    document.getElementById('widthMode').addEventListener('change', function() {
      sliceData.widthMode = this.value;
      applyPreview();
    });
    
    // åœ†è§’æ»‘å—
    document.getElementById('borderRadius').addEventListener('input', function() {
      sliceData.borderRadius = parseInt(this.value);
      document.getElementById('radiusVal').textContent = this.value;
      applyPreview();
    });
    
    // æ‹‰ä¼¸æ¨¡å¼é€‰æ‹©
    document.getElementById('repeatMode').addEventListener('change', function() {
      sliceData.repeatMode = this.value;
      applyPreview();
    });
    
    // æ–‡å­—å¯¹é½é€‰æ‹©
    document.getElementById('textAlign').addEventListener('change', function() {
      sliceData.textAlign = this.value;
      applyPreview();
    });
    
    // è¡Œé«˜æ»‘å—
    document.getElementById('lineHeight').addEventListener('input', function() {
      sliceData.lineHeight = parseFloat(this.value);
      document.getElementById('lineHeightVal').textContent = this.value;
      applyPreview();
    });
    
    // å­—ä½“å¤§å°æ»‘å—
    document.getElementById('fontSize').addEventListener('input', function() {
      sliceData.fontSize = parseInt(this.value);
      document.getElementById('fontSizeVal').textContent = this.value;
      applyPreview();
    });
    
    // å‚ç›´å¯¹é½é€‰æ‹©
    document.getElementById('verticalAlign').addEventListener('change', function() {
      sliceData.verticalAlign = this.value;
      applyPreview();
    });
    
    // è´´çº¸å›¾ç‰‡ä¸Šä¼ 
    document.getElementById('beforeUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          stickerData.before.url = event.target.result;
          document.getElementById('beforePreview').innerHTML = `âœ… å·²ä¸Šä¼ : ${file.name}`;
          applyPreview();
        };
        reader.readAsDataURL(file);
      }
    });
    
    document.getElementById('afterUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          stickerData.after.url = event.target.result;
          document.getElementById('afterPreview').innerHTML = `âœ… å·²ä¸Šä¼ : ${file.name}`;
          applyPreview();
        };
        reader.readAsDataURL(file);
      }
    });
    
    // è´´çº¸è¾“å…¥äº‹ä»¶
    ['before', 'after'].forEach(type => {
      ['Width', 'Height', 'Top'].forEach(prop => {
        const id = type + prop;
        const elem = document.getElementById(id);
        if (elem) {
          elem.addEventListener('input', function() {
            const key = prop.toLowerCase();
            stickerData[type][key] = parseInt(this.value);
            applyPreview(); // å®æ—¶æ›´æ–°é¢„è§ˆ
          });
        }
      });
      
      // ç‰¹æ®Šå¤„ç†
      if (type === 'before') {
        document.getElementById('beforeTop').addEventListener('input', function() {
          stickerData.before.top = parseInt(this.value);
          document.getElementById('beforeTopVal').textContent = this.value;
          applyPreview();
        });
        document.getElementById('beforePosition').addEventListener('change', function() {
          stickerData.before.position = this.value;
          applyPreview();
        });
        document.getElementById('beforeOffset').addEventListener('input', function() {
          stickerData.before.offset = parseInt(this.value);
          document.getElementById('beforeOffsetVal').textContent = this.value;
          applyPreview();
        });
        document.getElementById('beforeX').addEventListener('input', function() {
          stickerData.before.x = parseInt(this.value);
          document.getElementById('beforeXVal').textContent = this.value;
          applyPreview();
        });
      } else {
        document.getElementById('afterTop').addEventListener('input', function() {
          stickerData.after.top = parseInt(this.value);
          document.getElementById('afterTopVal').textContent = this.value;
          applyPreview();
        });
        document.getElementById('afterPosition').addEventListener('change', function() {
          stickerData.after.position = this.value;
          applyPreview();
        });
        document.getElementById('afterOffset').addEventListener('input', function() {
          stickerData.after.offset = parseInt(this.value);
          document.getElementById('afterOffsetVal').textContent = this.value;
          applyPreview();
        });
        document.getElementById('afterX').addEventListener('input', function() {
          stickerData.after.x = parseInt(this.value);
          document.getElementById('afterXVal').textContent = this.value;
          applyPreview();
        });
      }
      
      // å¯ç”¨checkbox
      document.getElementById(type + 'Enable').addEventListener('change', function() {
        stickerData[type].enabled = this.checked;
        applyPreview(); // å®æ—¶æ›´æ–°é¢„è§ˆ
      });
    });
    
    // åˆ‡æ¢è´´çº¸æ ‡ç­¾
    function switchSticker(type) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('stickerBefore').style.display = type === 'before' ? 'block' : 'none';
      document.getElementById('stickerAfter').style.display = type === 'after' ? 'block' : 'none';
    }
    
    // æ›´æ–°åˆ‡ç‰‡é¢„è§ˆ
    function updateSlicePreview() {
      if (!imageData.url) return;
      
      const preview = document.getElementById('slicePreview');
      preview.innerHTML = `
        <img src="${imageData.url}" style="max-width:100%; display:block;">
        <svg class="slice-lines" viewBox="0 0 ${imageData.width} ${imageData.height}" xmlns="http://www.w3.org/2000/svg">
          <!-- æ¨ªçº¿ -->
          <line x1="0" y1="${sliceData.top}" x2="${imageData.width}" y2="${sliceData.top}" stroke="#FF3B30" stroke-width="2" stroke-dasharray="5,5"/>
          <line x1="0" y1="${imageData.height - sliceData.bottom}" x2="${imageData.width}" y2="${imageData.height - sliceData.bottom}" stroke="#FF3B30" stroke-width="2" stroke-dasharray="5,5"/>
          
          <!-- ç«–çº¿ -->
          <line x1="${sliceData.left}" y1="0" x2="${sliceData.left}" y2="${imageData.height}" stroke="#FF3B30" stroke-width="2" stroke-dasharray="5,5"/>
          <line x1="${imageData.width - sliceData.right}" y1="0" x2="${imageData.width - sliceData.right}" y2="${imageData.height}" stroke="#FF3B30" stroke-width="2" stroke-dasharray="5,5"/>
          
          <!-- æ ‡æ³¨ -->
          <text x="${sliceData.left / 2}" y="20" fill="#FF3B30" font-size="14" font-weight="bold">â†” ${sliceData.left}px</text>
          <text x="10" y="${sliceData.top / 2 + 10}" fill="#FF3B30" font-size="14" font-weight="bold">â†• ${sliceData.top}px</text>
        </svg>
      `;
    }
    
    // ç”ŸæˆCSS
    function generateCSS() {
      if (!imageData.url) {
        alert('è¯·å…ˆä¸Šä¼ å›¾ç‰‡ï¼');
        return;
      }
      
      let css = `/* ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼ˆå³ä¾§ï¼‰ */\n`;
      css += `.message-container.sent .message-bubble {\n`;
      css += `  /* ä¹å®«æ ¼åˆ‡ç‰‡ */\n`;
      css += `  border-image-source: url('${imageData.url}') !important;\n`;
      css += `  border-image-slice: ${sliceData.top} ${sliceData.right} ${sliceData.bottom} ${sliceData.left} fill !important;\n`;
      css += `  border-image-width: ${sliceData.borderWidth}px !important;\n`;
      css += `  border-image-repeat: ${sliceData.repeatMode} !important;\n`;
      css += `  border-style: solid !important;\n`;
      css += `  border-color: transparent !important;\n`;
      css += `  border-width: 0 !important;\n`;
      css += `  \n`;
      css += `  /* åŸºç¡€æ ·å¼ */\n`;
      css += `  padding: ${sliceData.padding}px !important;\n`;
      css += `  max-width: ${sliceData.maxWidth}% !important;\n`;
      if (sliceData.widthMode === 'fixed-min' && sliceData.minWidth > 0) {
        css += `  min-width: ${sliceData.minWidth}px !important;\n`;
      }
      css += `  border-radius: ${sliceData.borderRadius}px !important;\n`;
      css += `  display: inline-block !important;\n`;
      css += `  box-sizing: border-box !important;\n`;
      css += `  word-wrap: break-word !important;\n`;
      css += `  word-break: break-word !important;\n`;
      css += `  white-space: pre-wrap !important;\n`;
      css += `  position: relative !important;\n`;
      css += `  background: transparent !important;\n`;
      css += `  text-align: ${sliceData.textAlign} !important;\n`;
      css += `  line-height: ${sliceData.lineHeight} !important;\n`;
      css += `  font-size: ${sliceData.fontSize}px !important;\n`;
      css += `  vertical-align: ${sliceData.verticalAlign} !important;\n`;
      css += `}\n\n`;
      
      css += `/* AIæ¥æ”¶çš„æ¶ˆæ¯ï¼ˆå·¦ä¾§ï¼‰ */\n`;
      css += `.message-container.received .message-bubble {\n`;
      css += `  border-image-source: url('${imageData.url}') !important;\n`;
      css += `  border-image-slice: ${sliceData.top} ${sliceData.right} ${sliceData.bottom} ${sliceData.left} fill !important;\n`;
      css += `  border-image-width: ${sliceData.borderWidth}px !important;\n`;
      css += `  border-image-repeat: ${sliceData.repeatMode} !important;\n`;
      css += `  border-style: solid !important;\n`;
      css += `  border-color: transparent !important;\n`;
      css += `  border-width: 0 !important;\n`;
      css += `  padding: ${sliceData.padding}px !important;\n`;
      css += `  max-width: ${sliceData.maxWidth}% !important;\n`;
      if (sliceData.widthMode === 'fixed-min' && sliceData.minWidth > 0) {
        css += `  min-width: ${sliceData.minWidth}px !important;\n`;
      }
      css += `  border-radius: ${sliceData.borderRadius}px !important;\n`;
      css += `  display: inline-block !important;\n`;
      css += `  box-sizing: border-box !important;\n`;
      css += `  word-wrap: break-word !important;\n`;
      css += `  word-break: break-word !important;\n`;
      css += `  white-space: pre-wrap !important;\n`;
      css += `  position: relative !important;\n`;
      css += `  background: transparent !important;\n`;
      css += `  text-align: ${sliceData.textAlign} !important;\n`;
      css += `  line-height: ${sliceData.lineHeight} !important;\n`;
      css += `  font-size: ${sliceData.fontSize}px !important;\n`;
      css += `  vertical-align: ${sliceData.verticalAlign} !important;\n`;
      css += `}\n`;
      
      // ::before è´´çº¸ï¼ˆç”¨æˆ·æ¶ˆæ¯ï¼‰
      if (stickerData.before.enabled && stickerData.before.url) {
        css += `\n/* ç”¨æˆ·æ¶ˆæ¯è´´çº¸è£…é¥° */\n`;
        css += `.message-container.sent .message-bubble::before {\n`;
        css += `  content: '';\n`;
        css += `  position: absolute;\n`;
        css += `  top: ${stickerData.before.top}px;\n`;
        // æ ¹æ®å®šä½æ–¹å¼ç”Ÿæˆleftæˆ–right
        if (stickerData.before.position === 'left') {
          const totalOffset = stickerData.before.offset + stickerData.before.x;
          css += `  left: ${totalOffset}px;\n`;
        } else {
          const totalOffset = stickerData.before.offset + stickerData.before.x;
          css += `  right: ${totalOffset}px;\n`;
        }
        css += `  width: ${stickerData.before.width}px;\n`;
        css += `  height: ${stickerData.before.height}px;\n`;
        css += `  background-image: url('${stickerData.before.url}');\n`;
        css += `  background-size: contain;\n`;
        css += `  background-repeat: no-repeat;\n`;
        css += `  pointer-events: none;\n`;
        css += `  z-index: 1;\n`;
        css += `}\n`;
      }
      
      // ::after è´´çº¸ï¼ˆAIæ¶ˆæ¯ï¼‰
      if (stickerData.after.enabled && stickerData.after.url) {
        css += `\n/* AIæ¶ˆæ¯è´´çº¸è£…é¥° */\n`;
        css += `.message-container.received .message-bubble::after {\n`;
        css += `  content: '';\n`;
        css += `  position: absolute;\n`;
        css += `  top: ${stickerData.after.top}px;\n`;
        // æ ¹æ®å®šä½æ–¹å¼ç”Ÿæˆleftæˆ–right
        if (stickerData.after.position === 'left') {
          const totalOffset = stickerData.after.offset + stickerData.after.x;
          css += `  left: ${totalOffset}px;\n`;
        } else {
          const totalOffset = stickerData.after.offset + stickerData.after.x;
          css += `  right: ${totalOffset}px;\n`;
        }
        css += `  width: ${stickerData.after.width}px;\n`;
        css += `  height: ${stickerData.after.height}px;\n`;
        css += `  background-image: url('${stickerData.after.url}');\n`;
        css += `  background-size: contain;\n`;
        css += `  background-repeat: no-repeat;\n`;
        css += `  pointer-events: none;\n`;
        css += `  z-index: 1;\n`;
        css += `}\n`;
      }
      
      document.getElementById('cssOutput').textContent = css;
    }
    
    // åº”ç”¨åˆ°é¢„è§ˆ
    function applyPreview() {
      if (!imageData.url) {
        return; // æ²¡æœ‰å›¾ç‰‡æ—¶é™é»˜è¿”å›
      }
      
      const bubbles = [
        document.getElementById('bubbleSent'),
        document.getElementById('bubbleReceived')
      ];
      
      bubbles.forEach(bubble => {
        bubble.style.borderImageSource = `url(${imageData.url})`;
        bubble.style.borderImageSlice = `${sliceData.top} ${sliceData.right} ${sliceData.bottom} ${sliceData.left} fill`;
        bubble.style.borderImageWidth = `${sliceData.borderWidth}px`;
        bubble.style.borderImageRepeat = sliceData.repeatMode;
        bubble.style.borderStyle = 'solid';
        bubble.style.borderColor = 'transparent';
        bubble.style.borderWidth = '0';
        bubble.style.background = 'transparent';
        bubble.style.color = '#000';
        bubble.style.position = 'relative';
        bubble.style.padding = `${sliceData.padding}px`;
        bubble.style.maxWidth = `${sliceData.maxWidth}%`;
        if (sliceData.widthMode === 'fixed-min' && sliceData.minWidth > 0) {
          bubble.style.minWidth = `${sliceData.minWidth}px`;
        } else {
          bubble.style.minWidth = '0';
        }
        bubble.style.borderRadius = `${sliceData.borderRadius}px`;
        bubble.style.textAlign = sliceData.textAlign;
        bubble.style.lineHeight = sliceData.lineHeight;
        bubble.style.fontSize = `${sliceData.fontSize}px`;
        bubble.style.verticalAlign = sliceData.verticalAlign;
        
        // æ¸…é™¤æ—§çš„ä¼ªå…ƒç´ æ ·å¼
        bubble.style.setProperty('--before-display', 'none');
        bubble.style.setProperty('--after-display', 'none');
        
        // åº”ç”¨ ::before
        if (stickerData.before.enabled && stickerData.before.url) {
          const style = document.createElement('style');
          style.id = 'before-style';
          document.head.querySelector('#before-style')?.remove();
          const totalOffset = stickerData.before.offset + stickerData.before.x;
          const positionProp = stickerData.before.position === 'left' ? 'left' : 'right';
          style.innerHTML = `.message-bubble::before {
            content: '';
            position: absolute;
            top: ${stickerData.before.top}px;
            ${positionProp}: ${totalOffset}px;
            width: ${stickerData.before.width}px;
            height: ${stickerData.before.height}px;
            background-image: url('${stickerData.before.url}');
            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: 1;
          }`;
          document.head.appendChild(style);
        }
        
        // åº”ç”¨ ::after
        if (stickerData.after.enabled && stickerData.after.url) {
          const style = document.createElement('style');
          style.id = 'after-style';
          document.head.querySelector('#after-style')?.remove();
          const totalOffset = stickerData.after.offset + stickerData.after.x;
          const positionProp = stickerData.after.position === 'left' ? 'left' : 'right';
          style.innerHTML = `.message-bubble::after {
            content: '';
            position: absolute;
            top: ${stickerData.after.top}px;
            ${positionProp}: ${totalOffset}px;
            width: ${stickerData.after.width}px;
            height: ${stickerData.after.height}px;
            background-image: url('${stickerData.after.url}');
            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: 1;
          }`;
          document.head.appendChild(style);
        }
      });
    }
    
    // å¤åˆ¶CSS
    function copyCSS() {
      const css = document.getElementById('cssOutput').textContent;
      navigator.clipboard.writeText(css).then(() => {
        alert('âœ… CSSå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
      });
    }
  </script>
</body>
</html>
