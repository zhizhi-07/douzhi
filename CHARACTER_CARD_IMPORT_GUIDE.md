# Character Card 导入功能说明

## 功能概述

在创建角色页面添加了 **SillyTavern 角色卡导入**功能，支持从 PNG 格式的 Character Card 中导入角色数据。

---

## 修改内容

### 1. 删除"所属世界"字段
- 移除了原有的"所属世界"输入框
- 简化了表单结构

### 2. 添加"上传"按钮
- 在顶部导航栏"完成"按钮旁边添加了"上传"按钮
- 点击可选择 PNG 格式的角色卡文件
- 导入过程中显示"导入中..."状态

### 3. 角色卡解析工具
- 新增 `src/utils/characterCardParser.ts` 工具文件
- 支持 Character Card V1 和 V2 格式
- 自动解析 PNG 中的角色数据

---

## 使用方法

1. **进入创建角色页面**
2. **点击"上传"按钮**
3. **选择 PNG 格式的角色卡文件**
   - 支持从 SillyTavern 导出的角色卡
   - 支持从其他兼容客户端导出的角色卡
4. **自动填充表单**
   - 角色名称
   - 头像（使用 PNG 图片）
   - 个性签名
   - 性格描述
5. **检查信息后点击"完成"保存**

---

## 支持的格式

### Character Card V1
- 基础格式，包含角色的基本信息

### Character Card V2
- 扩展格式，支持更多高级功能：
  - 系统提示词
  - 备用问候语
  - 标签和创建者信息
  - 世界书（Character Book）

---

## 导入的数据

- ✅ 角色名称
- ✅ 头像（PNG 图片本身）
- ✅ 角色描述
- ✅ 性格特征
- ✅ 场景设定
- ✅ 创建者信息
- ✅ 标签信息

---

## 技术特性

1. **PNG 解析**
   - 读取 PNG tEXt chunk 中的 'chara' 字段
   - Base64 解码
   - UTF-8 正确处理

2. **错误处理**
   - 文件格式验证
   - 数据结构验证
   - 友好的错误提示

3. **数据清理**
   - 自动清理循环引用
   - 防止栈溢出

---

## 文件变更

### 新增文件
- `src/utils/characterCardParser.ts` - 角色卡解析工具

### 修改文件
- `src/pages/CreateCharacter.tsx` - 创建角色页面
  - 删除"所属世界"字段
  - 添加"上传"按钮
  - 添加角色卡导入逻辑

---

## 示例

### 导入流程
```
1. 点击"上传"按钮
   ↓
2. 选择 PNG 文件
   ↓
3. 系统自动解析
   ↓
4. 表单自动填充
   ↓
5. 显示成功提示：
   "✅ 成功导入 Character Card V2!
    角色名: 小美
    创建者: 某某某"
```

---

## 注意事项

1. **只支持 PNG 格式**
   - 必须是从 SillyTavern 等工具导出的角色卡
   - 普通 PNG 图片无效

2. **导入后可以修改**
   - 所有字段都可以在导入后编辑
   - 可以更换头像

3. **世界书数据**
   - 当前版本会在控制台显示世界书信息
   - 世界书数据会保存在角色中

---

## 常见问题

**Q: 为什么我的 PNG 无法导入？**
A: 请确保这是从 SillyTavern 等酒馆客户端导出的角色卡，普通 PNG 图片不包含角色数据。

**Q: 导入的角色可以修改吗？**
A: 可以！导入后所有字段都可以编辑。

**Q: 支持哪些来源的角色卡？**
A: 支持所有符合 Character Card V1/V2 规范的角色卡：
- SillyTavern
- TavernAI
- Agnai
- RisuAI
- 其他兼容客户端

---

**现在就试试导入你的角色卡吧！** 🎉
