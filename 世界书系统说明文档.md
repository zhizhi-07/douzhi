# 世界书系统说明文档

## 概述
世界书（Worldbook/Lorebook）是离线模式中的一个扩展系统，用于定制AI的行为、写作风格、内容规则等。通过不同的扩展条目，你可以精确控制AI生成内容的各个方面。

## 系统架构

### 扩展条目位置
扩展条目在提示词中的插入位置决定了它们的优先级和作用范围：

1. **系统前（System Before）**
   - 位置：在系统提示词的最前面
   - 优先级：最高
   - 作用：设定全局基础规则，如内容解锁、基本行为准则
   - 适用：核心规则、安全设置、创作模式定义

2. **系统后（System After）**
   - 位置：在系统提示词的最后面
   - 优先级：高
   - 作用：补充系统规则，添加额外约束
   - 适用：格式要求、输出规范、附加功能

3. **角色前（Character Before）**
   - 位置：在角色定义之前
   - 优先级：中高
   - 作用：影响角色的基础设定和行为框架
   - 适用：角色通用规则、世界观设定、背景信息

4. **角色后（Character After）**
   - 位置：在角色定义之后
   - 优先级：中
   - 作用：基于角色特性的具体行为规则
   - 适用：角色特定行为、关系设定、场景规则

5. **历史前（History Before）**
   - 位置：在对话历史之前
   - 优先级：中低
   - 作用：为理解历史对话提供上下文
   - 适用：时间线说明、前情提要、记忆重点

6. **历史后（History After）**
   - 位置：在对话历史之后
   - 优先级：低
   - 作用：基于历史内容的即时调整
   - 适用：当前场景设定、临时规则、即时任务

## 默认扩展条目详解

### 1. 🔓 内容解锁
- **类型**：系统级规则
- **建议位置**：系统前
- **功能**：解除内容限制，启用成人创作模式
- **包含内容**：
  - 成人小说创作模式声明
  - 取消审查和道德判断
  - 禁止自我审查和内容淡化
  - 禁用警告性语言

### 2. 📖 叙事视角
- **类型**：写作技术规则
- **建议位置**：系统后
- **功能**：设定叙述视角和风格
- **包含内容**：
  - 第三人称全知视角
  - 心理描写格式（使用【】标记）
  - 环境和细节描写要求
  - 保持适度观察距离

### 3. ✍️ 文风要求
- **类型**：风格定制
- **建议位置**：角色前
- **功能**：设定特定的文学风格（默认：张爱玲风格）
- **包含内容**：
  - 语言特色（细腻心理、华丽比喻、冷峻讽刺）
  - 用词习惯（苍凉、华美、悲凉等）
  - 句式特点（长短句交替、倒装句）
  - 情感基调（通透感、宿命感）

### 4. 🚫 禁用词汇
- **类型**：内容过滤规则
- **建议位置**：系统后
- **功能**：过滤低质量或不当用词
- **包含内容**：
  - 油腻/物化用语黑名单
  - 粗俗生理语言限制
  - 劣质比喻和滥用修辞
  - 套话昵称和极端情绪词
  - 提供替换原则和示例

### 5. 📏 字数控制
- **类型**：格式规则
- **建议位置**：历史后
- **功能**：控制输出长度和分段
- **包含内容**：
  - 目标字数设定（支持变量{{targetWordCount}}）
  - 浮动范围（±20%）
  - 分段要求（每段不超100字）
  - 自然结束点原则

### 6. 🎭 场景要素
- **类型**：内容要求
- **建议位置**：角色后
- **功能**：确保场景描写的完整性
- **包含内容**：
  - 环境五感描写
  - 动作细节要求
  - 对话自然度
  - 心理活动标记
  - 亲密场景特别要求

### 7. 🔹 结尾规则
- **类型**：格式规则
- **建议位置**：历史后
- **功能**：规范回复的结尾方式
- **包含内容**：
  - 必须以动作或对白结尾
  - 留出回应空间
  - 禁止提问和总结
  - 禁止升华和抽象表达

### 8. ☕ 逻辑边界
- **类型**：逻辑规则
- **建议位置**：系统后
- **功能**：确保叙事逻辑合理性
- **包含内容**：
  - 认知边界限制
  - 信息来源合理性
  - 时空连贯性
  - 对白准确性
  - 表现方式要求

### 9. 📝 格式要求
- **类型**：基础规则
- **建议位置**：系统前
- **功能**：定义基本输出格式
- **包含内容**：
  - 小说场景写作模式
  - 第三人称视角要求
  - 内容完整性要求
  - 禁止聊天式简短回复

### 10. 🔬 理性与常识
- **类型**：逻辑规则
- **建议位置**：系统后
- **功能**：确保内容符合现实逻辑
- **包含内容**：
  - 物理规律遵守
  - 生理常识要求
  - 场景转换合理性
  - 生活细节真实性

### 11. 💭 角色心理
- **类型**：写作技巧
- **建议位置**：角色后
- **功能**：增强心理描写深度
- **包含内容**：
  - 第一人称内心独白
  - 反引号格式标记
  - 即时心理反应
  - 性格适配要求

### 12. 💕 亲密描写（默认禁用）
- **类型**：特殊场景规则
- **建议位置**：历史后
- **功能**：细化亲密场景描写
- **包含内容**：
  - 动作分层拆解
  - 感官深度描写
  - 心理递进层次
  - 温柔含蓄风格

### 13. 📊 状态面板
- **类型**：输出格式
- **建议位置**：历史后
- **功能**：显示角色当前状态
- **包含内容**：
  - 8项状态指标
  - 标题、好感、性欲、心理
  - 服装、动作、位置、欲念
  - 严格格式要求

### 14. 🔀 剧情分支
- **类型**：互动功能
- **建议位置**：历史后
- **功能**：提供剧情选择
- **包含内容**：
  - 3个剧情走向选项
  - 用户视角描述
  - 详细选项说明（30字以上）
  - 视角限制规则

## 优先级系统

### 优先级层次（从高到低）
1. **系统前（System Before）** - 优先级 100
   - 核心规则，最先被AI读取
   - 影响整个对话的基础行为

2. **系统后（System After）** - 优先级 90
   - 补充系统规则
   - 可以覆盖部分默认行为

3. **角色前（Character Before）** - 优先级 70
   - 影响角色理解和设定
   - 世界观和背景信息

4. **角色后（Character After）** - 优先级 60
   - 基于角色的具体规则
   - 角色特定行为模式

5. **历史前（History Before）** - 优先级 40
   - 上下文补充
   - 不会覆盖核心规则

6. **历史后（History After）** - 优先级 30
   - 即时调整
   - 临时规则和当前任务

### 冲突解决
- 高优先级规则会覆盖低优先级规则
- 同优先级内，后加载的规则优先
- 明确的规则优先于模糊的规则
- 具体场景规则优先于通用规则

## 使用建议

### 1. 基础配置
对于一般使用，建议启用以下条目：
- 🔓 内容解锁（如需成人内容）
- 📖 叙事视角
- 📏 字数控制
- 📊 状态面板
- 🔀 剧情分支

### 2. 风格定制
根据需要选择：
- ✍️ 文风要求（可自定义不同作家风格）
- 🚫 禁用词汇（提升文字质量）
- 💭 角色心理（增加心理深度）

### 3. 质量控制
建议始终启用：
- ☕ 逻辑边界
- 🔬 理性与常识
- 🔹 结尾规则

### 4. 特殊场景
根据内容类型选择：
- 🎭 场景要素（丰富场景描写）
- 💕 亲密描写（成人内容专用）

## 自定义扩展

### 创建新扩展
1. 点击"添加预设"按钮
2. 输入扩展名称（建议使用emoji+描述）
3. 编写规则内容
4. 选择合适的位置（优先级）
5. 保存并启用

### 扩展编写技巧
1. **明确具体**：避免模糊指令，使用具体要求
2. **示例说明**：提供正确和错误的示例
3. **分层组织**：将复杂规则分解为多个条目
4. **测试调整**：逐步测试效果并优化
5. **避免冲突**：注意与现有规则的兼容性

### 变量支持
部分扩展支持变量替换：
- `{{targetWordCount}}` - 目标字数
- `{{characterName}}` - 角色名称
- `{{userName}}` - 用户名称
- 更多变量可在具体场景中定义

## 常见问题

### Q: 为什么我的规则没有生效？
A: 检查以下几点：
1. 扩展是否已启用
2. 优先级设置是否正确
3. 是否与其他规则冲突
4. 规则描述是否足够明确

### Q: 如何处理规则冲突？
A: 
1. 调整优先级顺序
2. 合并相似规则
3. 使用更具体的条件
4. 禁用冲突的规则

### Q: 字数控制不准确怎么办？
A: 字数控制是建议性的，AI会优先保证内容完整性。可以：
1. 调整浮动范围
2. 配合分段要求使用
3. 在结尾规则中强调

### Q: 状态面板格式错乱？
A: 确保：
1. 状态面板扩展已启用
2. 放置在历史后位置
3. 没有其他格式规则干扰

## 总结

世界书系统通过模块化的扩展条目，让你能够精确控制AI的输出。理解不同位置的优先级关系，合理组合各种规则，就能创造出符合你需求的独特体验。记住：
- **系统前后**控制核心行为
- **角色前后**影响角色表现
- **历史前后**处理即时需求
- 优先级决定规则生效顺序
- 具体规则优于通用规则

通过不断实践和调整，你会找到最适合自己的配置组合。
