# 🌍 "第二人生" (Second Life) 开放世界设计方案

> 核心愿景：打造一个玩家与AI共存、拥有独立时间轴和生态的“活的世界”。不仅仅是聊天，而是生活。

## 1. 核心玩法融合 (The Trinity)
正如你所想，我们要融合三种体验：
1.  **LBS生活感**（上帝视角）：在地图上看到AI的行动轨迹，产生“她们真的生活在这里”的错觉。
2.  **视觉小说**（沉浸感）：进入地点后，有画面、有环境描写，像读小说一样有代入感。
3.  **文字冒险**（高自由度）：不局限于选项，可以说任何话，做任何动作，由AI判定结果。

---

## 2. 玩家系统：不仅是账号，是“角色” (The Protagonist)
你需要在这个世界有一个**实体**。

### 2.1 基础属性 (Stats)
引入轻量级的RPG数值，限制无限交互，增加策略感：
*   **⚡ 体力 (Energy)**：
    *   上限100。
    *   移动消耗5，深度聊天消耗2，工作消耗20。
    *   归零后必须回家睡觉或在长椅上休息。
*   **💰 资金 (Money)**：
    *   初始资金。
    *   用途：坐车、买礼物、在餐厅吃饭、给AI发红包。
    *   获取：打工、随机事件捡钱、签到。
*   **📍 坐标 (Location)**：
    *   你当前所在的地点ID（如 `home`, `park`, `cafe`）。
*   **🎒 背包 (Inventory)**：
    *   持有的物品（商店购买或探索获得）。

### 2.2 身份设定 (Identity)
*   在开始游戏前，可以让玩家简单填写一个“人设卡”（职业、性格关键词）。
*   这个设定会被注入到 System Prompt 中，AI在和你互动时会以此为据（例如：如果你设定是“穷学生”，富家千金AI可能会以此调侃你）。

---

## 3. 地图与探索系统 (Exploration System)

### 3.1 宏观地图 (Macro Map) - *上帝视角*
*   **界面**：目前的 Leaflet 地图。
*   **功能**：
    *   显示所有已解锁地点（家、学校、商场、公园、酒吧等）。
    *   **实时显示AI位置**：你会看到“喵小九”的头像在地图上移动（基于日程表算法）。
    *   **移动操作**：点击地点 -> 确认移动（显示消耗体力/时间）-> 播放简单的过场动画 -> 进入【微观场景】。

### 3.2 微观场景 (Micro Scene) - *视觉小说视角*
*   **界面**：
    *   **背景**：当前地点的精美插图（根据时间变化，如白天/黄昏/夜晚）。
    *   **HUD**：顶部显示你的属性（体力、钱），底部是操作栏。
    *   **主文本区**：滚动的剧情日志。
*   **环境流 (Ambient Text)**：
    *   每次进入或刷新，AI会生成一段环境描写。
    *   *例：“午夜的便利店冷气开得很足，货架上的便当只剩最后一份了，收银员正打着哈欠。”*

### 3.3 交互操作 (Actions)
在微观场景中，你可以做的事：
1.  **👁️ 观察 (Observe)**：获取更详细的环境信息，寻找隐藏物品。
2.  **💬 呼喊/说话 (Shout/Talk)**：对空说话，或者对当前场景里的所有人说话。
3.  **✋ 互动 (Interact)**：根据地点不同而不同（在商店是“购买”，在公园是“坐下”，在酒吧是“点单”）。
4.  **✨ 偶遇 (Encounter)**：**这是核心！**
    *   如果该地点当前有AI -> 界面上会显示AI的立绘。
    *   你可以点击AI -> **无缝切入对话模式**。
    *   此时的对话带有强烈的**场景上下文**（Context）。你们是在“便利店”偶遇的，话题自然会从“你也来买夜宵吗？”开始。

---

## 4. AI生态系统：独立的时间轴 (The Living World)
AI不应该只活在聊天框里，她们应该有自己的生活。

### 4.1 日程表系统 (Scheduler)
每个AI配置一份简单的概率日程表：
```typescript
const schedule = {
  morning: ['school', 'library'], // 早上大概率在学校或图书馆
  afternoon: ['cafe', 'arcade', 'park'], // 下午可能去玩
  night: ['home', 'bar'], // 晚上回家或去酒吧
  lateNight: ['home'] // 深夜一定在家
}
```
*   **逻辑**：系统每隔一段时间（或玩家每次移动时），刷新一次所有AI的位置。

### 4.2 状态机 (Status)
AI处于不同状态时，对你的打扰会有不同反应：
*   **Idle (闲逛)**：很高兴见到你，主动搭话。
*   **Busy (忙碌)**：比如正在打工，回复会简短，“稍等，我先忙完这个”。
*   **Private (私密)**：比如在家里睡觉，你如果强行闯入（去她家），可能会被赶出来或扣好感度。

---

## 5. 技术实现路线 (Roadmap)

### Phase 1: 基础框架搭建
1.  **数据结构定义**：定义 `Player` 和 `Location` 的 interface。
2.  **场景查看器**：改造 `Map.tsx`，实现点击地点 -> 切换到底图+文字描述的界面。
3.  **环境描写API**：写一个 prompt，专门用于让 LLM 生成“简短、有氛围感的环境描写”。

### Phase 2: 引入角色与移动
1.  **位置同步**：在 `localStorage` 存储每个角色的 `currentLocation`。
2.  **移动逻辑**：简单的随机移动算法，让AI在地图上跑起来。
3.  **偶遇逻辑**：当你进入地点时，检测 `location.visitors.includes(ai_id)`。

### Phase 3: 第二人生完全体
1.  **属性系统**：加入体力条和金钱系统。
2.  **物品与交易**：在特定地点可以买东西。
3.  **自由输入**：允许玩家输入 `"/me 拿起桌上的酒杯摔在地上"`，AI识别动作并生成后果。

---

## 6. 界面原型构思 (Mockup Idea)

```text
+--------------------------------------------------+
|  [❤️ 80/100]  [💰 500G]  [📍 星河公园 (20:00)]     | <- 状态栏
+--------------------------------------------------+
|                                                  |
|             (这里是公园的精美背景图)               |
|                                                  |
|      [喵小九的立绘]        [长椅]   [自动售货机]    |
|                                                  |
+--------------------------------------------------+
| 📜 日志:                                         |
| > 你走进了星河公园。晚风带着一丝凉意。                 |
| > 喵小九正坐在长椅上发呆，手里拿着一个吃了一半的冰淇淋。   |
|                                                  |
+--------------------------------------------------+
| [打招呼]  [观察]  [坐下]  [离开]  [输入自由动作...] | <- 操作栏
+--------------------------------------------------+
```
