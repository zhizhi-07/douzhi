# 你画我猜游戏重构 - 需求文档

## 简介

重构"你画我猜"和"你演我猜"游戏功能，使其符合真实游戏逻辑：用户画画/描述 → AI猜测 → 系统自动判断对错 → 显示结果。移除复杂的手动确认流程，让游戏体验更流畅自然。

## 术语表

- **游戏系统 (Game System)**: 管理你画我猜和你演我猜游戏的整体系统
- **画板 (Drawing Panel)**: 用户绘画的界面组件
- **题目卡片 (Topic Card)**: 显示当前游戏题目的悬浮卡片
- **AI猜测 (AI Guess)**: AI根据用户的画作或描述给出的答案
- **答案匹配 (Answer Matching)**: 系统判断AI的回复是否包含正确答案的逻辑

## 需求

### 需求 1: 游戏启动和题目生成

**用户故事:** 作为用户，我想要快速开始一局你画我猜游戏，这样我可以和AI角色互动娱乐。

#### 验收标准

1. WHEN 用户点击"默契"按钮 THEN 游戏系统 SHALL 显示游戏类型选择界面（你画我猜/你演我猜）
2. WHEN 用户选择游戏类型 THEN 游戏系统 SHALL 从预设题库中随机选择一个题目并显示题目卡片
3. WHEN 题目卡片显示时 THEN 游戏系统 SHALL 提供"换题"按钮允许用户重新随机选择题目
4. WHEN 用户点击"换题"按钮 THEN 游戏系统 SHALL 立即生成新的随机题目并更新显示
5. WHEN 题目卡片显示时 THEN 游戏系统 SHALL 显示"画板"或"输入"按钮以打开相应的创作界面

### 需求 2: 画作创作和发送

**用户故事:** 作为用户，我想要在画板上绘画并发送给AI，这样AI可以猜测我画的内容。

#### 验收标准

1. WHEN 用户点击"画板"按钮 THEN 游戏系统 SHALL 打开悬浮画板界面
2. WHEN 画板打开时 THEN 游戏系统 SHALL 提供绘画工具（画笔、清空、关闭）
3. WHEN 用户在画板上绘画 THEN 游戏系统 SHALL 实时记录绘画内容
4. WHEN 用户点击"发送"按钮 THEN 游戏系统 SHALL 将画作作为图片消息发送到聊天
5. WHEN 画作发送后 THEN 游戏系统 SHALL 自动触发AI回复请求
6. WHEN 画作发送时 THEN 游戏系统 SHALL 在用户可见的消息中隐藏答案，仅显示"[你画我猜]"
7. WHEN 画作发送时 THEN 游戏系统 SHALL 在AI可读内容中包含清晰的游戏说明，要求AI直接猜测

### 需求 3: 描述创作和发送（你演我猜）

**用户故事:** 作为用户，我想要用文字描述动作让AI猜测，这样我可以玩"你演我猜"游戏。

#### 验收标准

1. WHEN 用户选择"你演我猜"游戏 THEN 游戏系统 SHALL 显示文本输入界面
2. WHEN 用户输入描述文字 THEN 游戏系统 SHALL 允许最多50个字符的描述
3. WHEN 用户点击"发送"按钮 THEN 游戏系统 SHALL 将描述作为文本消息发送到聊天
4. WHEN 描述发送后 THEN 游戏系统 SHALL 自动触发AI回复请求
5. WHEN 描述发送时 THEN 游戏系统 SHALL 在AI可读内容中包含游戏说明和用户的描述

### 需求 4: AI猜测和答案判断

**用户故事:** 作为用户，我想要系统自动判断AI是否猜对，这样游戏流程更流畅不需要手动确认。

#### 验收标准

1. WHEN AI回复消息时 THEN 游戏系统 SHALL 自动检查回复内容是否包含正确答案
2. WHEN AI回复包含正确答案 THEN 游戏系统 SHALL 自动发送成功消息"🎉 猜对了！答案是「{题目}」"
3. WHEN AI回复包含正确答案 THEN 游戏系统 SHALL 自动结束当前游戏并清理游戏状态
4. WHEN AI回复不包含正确答案 THEN 游戏系统 SHALL 保持游戏状态，允许用户继续画或重新描述
5. WHEN 答案判断时 THEN 游戏系统 SHALL 使用模糊匹配算法（忽略标点、空格、大小写）
6. WHEN 答案判断时 THEN 游戏系统 SHALL 支持同义词匹配（例如"汽车"和"车"）

### 需求 5: 游戏状态管理

**用户故事:** 作为用户，我想要清晰的游戏状态反馈，这样我知道游戏进行到哪一步。

#### 验收标准

1. WHEN 游戏进行中 THEN 游戏系统 SHALL 在顶部显示题目卡片
2. WHEN 用户发送画作或描述后 THEN 游戏系统 SHALL 关闭画板/输入面板但保留题目卡片
3. WHEN AI正在思考时 THEN 游戏系统 SHALL 在题目卡片上显示"AI正在猜测..."提示
4. WHEN 游戏结束时 THEN 游戏系统 SHALL 移除题目卡片和所有游戏UI
5. WHEN 用户点击题目卡片的关闭按钮 THEN 游戏系统 SHALL 立即结束游戏并清理所有状态

### 需求 6: 多轮游戏支持

**用户故事:** 作为用户，我想要在AI猜错时继续尝试，这样游戏更有挑战性。

#### 验收标准

1. WHEN AI第一次猜错 THEN 游戏系统 SHALL 保持游戏状态不变
2. WHEN AI猜错后 THEN 游戏系统 SHALL 允许用户重新打开画板继续画
3. WHEN 用户重新打开画板 THEN 游戏系统 SHALL 保留之前的绘画内容
4. WHEN 用户发送新的画作 THEN 游戏系统 SHALL 再次触发AI猜测
5. WHEN 用户想放弃时 THEN 游戏系统 SHALL 提供关闭按钮立即结束游戏

### 需求 7: 简化的AI提示词

**用户故事:** 作为系统，我想要给AI简洁清晰的提示，这样AI能更自然地参与游戏。

#### 验收标准

1. WHEN 发送画作给AI THEN 游戏系统 SHALL 使用简洁的提示词"这是一幅画，猜猜画的是什么？"
2. WHEN 发送描述给AI THEN 游戏系统 SHALL 使用简洁的提示词"根据这个描述猜猜是什么动作：{描述}"
3. WHEN 构建AI提示时 THEN 游戏系统 SHALL 不强制AI使用特定回复格式
4. WHEN 构建AI提示时 THEN 游戏系统 SHALL 鼓励AI自然回复，可以包含推理过程
5. WHEN AI回复后 THEN 游戏系统 SHALL 从AI的自然语言回复中提取答案进行判断

### 需求 8: 画板状态持久化

**用户故事:** 作为用户，我想要在关闭画板后能恢复之前的绘画，这样我可以继续完善作品。

#### 验收标准

1. WHEN 用户关闭画板 THEN 游戏系统 SHALL 保存当前画布内容到内存
2. WHEN 用户重新打开画板 THEN 游戏系统 SHALL 恢复之前保存的画布内容
3. WHEN 用户点击"清空"按钮 THEN 游戏系统 SHALL 清除画布内容和保存的数据
4. WHEN 游戏结束时 THEN 游戏系统 SHALL 清除所有保存的画布数据
5. WHEN 用户换题时 THEN 游戏系统 SHALL 清除之前的画布数据
