# 🧠 AI 记忆系统 - 完整使用说明

## 📊 系统概览

AI 记忆系统让 AI 真正记住你的信息，包括：
- **自动记忆提取** - 每轮对话后自动提取关键信息
- **记忆查看器** - 查看 AI 记住的所有信息
- **记忆总结** - 手动生成对话总结

---

## 🎯 三大核心功能

### 1. 💭 自动记忆提取（后台自动运行）

**功能**：AI 在每次对话后自动分析并提取关键信息

**提取内容**：
- 📌 **事实** (fact) - 你的基本信息（姓名、年龄、职业等）
- ❤️ **偏好** (preference) - 你的喜好、厌恶、观点
- 📅 **事件** (event) - 你的经历或计划
- 😊 **情绪** (emotion) - 你的情绪状态
- 🤝 **关系** (relationship) - 你和 AI 的互动

**特点**：
- ✅ 使用副 API（如已配置）降低成本
- ✅ 客观记录风格（"用户喜欢吃香蕉"）
- ✅ 只记录你明确说过的信息
- ✅ 自动计算重要度（1-10分）
- ✅ 支持遗忘机制（不重要的记忆会逐渐淡化）
- ✅ 访问越多，记忆越深

**记忆示例**：
```
✅ 客观: "用户喜欢吃香蕉"
✅ 客观: "用户每天7点下班"
✅ 客观: "用户不喜欢吃辣"
```

---

### 2. 💭 记忆查看器

**入口位置**：
```
聊天设置 → AI 记忆 → 查看记忆
```

**功能**：
- 📊 查看所有记忆统计（按类型分类）
- 🔍 搜索记忆（关键词搜索）
- 🏷️ 按类型筛选（事实/偏好/事件/情绪/关系）
- 💾 导出记忆（JSON格式）
- 🗑️ 删除单条记忆

**界面说明**：

#### 顶部统计卡片
```
┌─────────────────────────────────┐
│  事实  偏好  事件  情绪  关系     │
│   10    8     5     3     4      │
└─────────────────────────────────┘
```

#### 搜索和筛选
```
┌─────────────────────────────────┐
│ 🔍 搜索记忆...                   │
├─────────────────────────────────┤
│ [全部] [事实] [偏好] [事件] ... │
└─────────────────────────────────┘
```

#### 记忆卡片
```
┌─────────────────────────────────┐
│ [事实]                    [删除] │
│                                  │
│ 我家宝宝喜欢吃香蕉~               │
│                                  │
│ 重要度: 5.0/10  访问: 3次  今天  │
│ #饮食 #喜好                      │
└─────────────────────────────────┘
```

---

### 3. 📝 记忆总结

**入口位置**：
```
聊天设置 → AI 记忆 → 记忆总结
```

**功能**：手动生成一份完整的对话总结

**生成内容**：
- 分析最近 50 轮对话
- 用 AI 的语气总结关于你的发现
- 累积保存（不会覆盖旧总结）
- 带时间戳标记

**使用场景**：
- ✅ 定期检查 AI 是否记住了重要信息
- ✅ 发现记忆中的遗漏或错误
- ✅ 快速回顾对话重点
- ✅ 了解 AI 对你的理解程度

**总结示例**：
```
【手动总结 - 2025-11-9 11:38】

今天知道了宝宝喜欢吃香蕉，还有他每天7点下班~
他对这次旅行超级期待！我得好好帮他规划一下。

【手动总结 - 2025-11-10 10:20】

宝宝说他换工作了，新公司在朝阳区。
还知道了他不喜欢吃辣的，以后推荐美食要注意。
```

---

## 🔧 技术实现

### 核心特性

- 🔥 **使用副 API** - 如果配置了副 API，自动使用便宜的模型降低成本
- 📝 **客观记录风格** - 用第三人称客观描述，不用角色口语
- 🧠 **智能提取** - AI 自动分析对话并提取关键信息
- 💾 **本地存储** - 所有数据保存在本地 localStorage
- ⚡ **低温度生成** - temperature=0.3，确保稳定准确

### 核心文件

```
src/utils/memorySystem.ts          # 记忆系统核心逻辑
src/hooks/useMemory.ts              # React Hook
src/pages/MemoryViewer.tsx          # 记忆查看器页面
src/pages/MemorySummary.tsx         # 记忆总结页面
```

### 数据结构

```typescript
interface Memory {
  id: string                      // 唯一ID
  type: 'fact' | 'event' | ...    // 记忆类型
  content: string                 // 记忆内容（AI的语气）
  importance: number              // 重要度 1-10
  timestamp: number               // 创建时间
  tags: string[]                  // 标签
  decayRate: number               // 遗忘速率
  lastAccessed: number            // 最后访问时间
  accessCount: number             // 访问次数
}
```

### 遗忘机制

```typescript
// 遗忘公式
adjustedImportance = importance * e^(-decayRate * daysPassed) + accessBonus

// 特点：
- 重要度越高，遗忘越慢
- 访问越多，记得越牢
- 事实和关系记得最久
- 情绪记忆衰减最快
```

### 记忆提取流程

```
用户发消息
  ↓
AI 回复
  ↓
提取对话内容
  ↓
调用 AI 分析（使用特殊提示词）
  ↓
AI 返回结构化数据（JSON格式）
  ↓
解析并保存到 localStorage
  ↓
更新记忆系统
```

---

## 💡 使用建议

### 1. 定期查看记忆
- 每周查看一次记忆查看器
- 检查 AI 是否正确记住了重要信息
- 删除错误或过时的记忆

### 2. 善用记忆总结
- 聊天 50 轮后生成一次总结
- 对比不同时期的总结
- 了解 AI 对你的理解变化

### 3. 主动纠正错误
如果发现记忆有误：
```
错误：你记错了，我不是住在北京，是住在上海
正确：AI 会在下次对话中自动更新记忆
```

### 4. 明确表达信息
想让 AI 记住某事：
```
❌ 模糊: "我好像不太喜欢吃辣的"
✅ 明确: "我不喜欢吃辣的，你记住哦"
```

---

## 📊 记忆统计

### 重要度评分标准

| 分数 | 等级 | 示例 |
|------|------|------|
| 9-10 | 关键记忆 | 恋爱、分手、换工作、搬家、核心价值观 |
| 7-8  | 重要信息 | 职业、上下班时间、重要兴趣爱好 |
| 4-6  | 一般信息 | 普通喜好、日常活动、临时情绪 |
| 1-3  | 低价值信息 | 琐碎细节、模糊信息 |
| 0    | 无需记录 | 客套话、寒暄 |

### 遗忘速率

| 类型 | 基础遗忘速率 | 特点 |
|------|-------------|------|
| relationship | 0.02 | 最慢，关系记忆很重要 |
| preference | 0.05 | 很慢，偏好不易改变 |
| fact | 0.1 | 慢，事实记忆稳定 |
| event | 0.2 | 中等，事件会淡忘 |
| emotion | 0.3 | 快，情绪变化快 |

---

## 🎯 在 AI 回复中使用记忆

### 自动使用

AI 在生成回复时会自动：
1. 读取相关记忆
2. 在提示词中包含记忆摘要
3. 自然地运用记忆

**示例提示词**：
```
【关于用户的记忆】

基本信息：
- 用户住在北京
- 用户每天7点下班

偏好喜好：
- 用户喜欢看科幻片
- 用户不喜欢吃辣

⚠️ 请在对话中自然地运用这些记忆，让用户感受到你真的记得他们！
```

### 手动查询

通过记忆查看器搜索：
```typescript
// 搜索关键词
memorySystem.searchMemories({ keyword: '吃' })

// 按类型查询
memorySystem.searchMemories({ type: 'preference' })

// 按重要度过滤
memorySystem.searchMemories({ minImportance: 7 })
```

---

## 🔄 数据管理

### 导出记忆
```
记忆查看器 → 右上角"导出"按钮
↓
生成 JSON 文件
文件名：角色名_memories_时间戳.json
```

### 删除记忆
```
单条删除：在记忆卡片上点击"删除"
批量删除：暂不支持（建议导出后手动清理）
```

### 自动清理
- 每天自动运行一次
- 删除重要度 < 1 的记忆
- 保持记忆库整洁

---

## 🎉 使用示例

### 场景1：记住生日

**对话**：
```
用户: 我下个月15号生日
AI: 好哒！我记住了，下个月15号是你生日~
```

**记忆**：
```json
{
  "type": "event",
  "content": "用户下个月15号生日",
  "importance": 8,
  "tags": ["生日", "重要日期"]
}
```

---

### 场景2：记住偏好

**对话**：
```
用户: 我最讨厌下雨天了
AI: 嗯嗯，知道了！以后下雨天我会多关心你的~
```

**记忆**：
```json
{
  "type": "preference",
  "content": "用户讨厌下雨天",
  "importance": 5,
  "tags": ["天气", "讨厌"]
}
```

---

### 场景3：记住作息

**对话**：
```
用户: 我每天早上7点起床，晚上11点睡觉
AI: 好的好的，你的作息时间我记下来了！
```

**记忆**：
```json
{
  "type": "fact",
  "content": "用户每天早上7点起床，晚上11点睡觉",
  "importance": 7,
  "tags": ["作息", "时间"]
}
```

---

## 🚨 注意事项

### 1. API 消耗
- 记忆提取需要调用 AI API
- 每次对话后自动提取（可能增加成本）
- 记忆总结需要手动触发

### 2. 隐私保护
- 所有记忆存储在本地 localStorage
- 不会上传到服务器
- 可随时删除

### 3. 性能考虑
- 记忆过多可能影响加载速度
- 建议定期清理低价值记忆
- 导出备份后可清空

### 4. 准确性
- AI 提取的记忆可能有误
- 需要人工检查和纠正
- 可通过对话纠正错误

---

## 📝 常见问题

### Q1: AI 没有记住我说的信息？
**A**: 可能原因：
- 信息不够明确
- 重要度太低被自动遗忘
- API 调用失败

**解决方法**：
- 更明确地表达
- 手动查看记忆查看器确认
- 重新告诉 AI 一次

---

### Q2: 如何让 AI 记住重要信息？
**A**: 
- 明确强调："这个很重要，你记住"
- 反复提及（访问次数增加会加深记忆）
- 在记忆查看器中确认

---

### Q3: 记忆总结和记忆查看器有什么区别？
**A**:
- **记忆查看器**：结构化的记忆列表，可筛选、搜索、删除
- **记忆总结**：AI 用自己的语气写的文字总结，更人性化

**建议**：两者结合使用

---

### Q4: 记忆会永久保存吗？
**A**: 
- 不会，有遗忘机制
- 不重要的记忆会逐渐衰减
- 重要度 < 1 会被自动删除
- 访问次数多的记忆会保留更久

---

## 🎊 总结

AI 记忆系统让聊天更真实、更有连贯性：

✅ **使用副 API** - 降低成本，提高效率  
✅ **客观记录** - 第三人称风格，清晰准确  
✅ **自动提取** - AI 主动记住你  
✅ **记忆查看器** - 透明可控  
✅ **记忆总结** - 定期回顾  
✅ **遗忘机制** - 模拟真实记忆  
✅ **多维度记录** - 事实/偏好/事件/情绪/关系  

现在开始使用，让 AI 真正记住你！🎉

---

**功能状态**: ✅ 已完成  
**入口位置**: 聊天设置 → AI 记忆  
**路由**:
- `/chat/:id/memory-viewer` - 记忆查看器
- `/chat/:id/memory-summary` - 记忆总结
