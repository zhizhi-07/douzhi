# æ‹‰é»‘æ„Ÿå¹å·è°ƒè¯•æŒ‡å—

## ğŸ” æµ‹è¯•æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°
- åˆ‡æ¢åˆ° Console æ ‡ç­¾é¡µ

### 2. æµ‹è¯•æµç¨‹

#### A. ç”¨æˆ·æ‹‰é»‘AI
1. åœ¨èŠå¤©è®¾ç½®ä¸­**ç”¨æˆ·æ‹‰é»‘AI**
2. è®©AIå‘é€ç‰¹æ®Šæ¶ˆæ¯ï¼ˆå¦‚è¡¨æƒ…åŒ…ï¼‰
   - æç¤ºè¯ç¤ºä¾‹ï¼š`ç»™æˆ‘å‘ä¸ªè¡¨æƒ…åŒ…`
3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼š

**åº”è¯¥çœ‹åˆ°çš„æ—¥å¿—ï¼š**
```
ğŸ¯ [commandHandler] å¤„ç†æŒ‡ä»¤ï¼ŒisBlocked=true { ... }
ğŸš« [createMessageObj] åˆ›å»ºæ‹‰é»‘æ¶ˆæ¯: { type: 'emoji', blocked: true, ... }
ğŸ’¾ [addMessage] å·²ä¿å­˜æ¶ˆæ¯åˆ°localStorage: { blocked: true, ... }
ğŸ” [æ¸²æŸ“ç‰¹æ®Šæ¶ˆæ¯] type=emoji, blocked=true, shouldShowExclamation=true
```

4. **æ£€æŸ¥ç•Œé¢**ï¼šè¡¨æƒ…åŒ…å³ä¾§åº”è¯¥æ˜¾ç¤ºçº¢è‰²æ„Ÿå¹å· â—

#### B. AIæ‹‰é»‘ç”¨æˆ·ï¼ˆæµ‹è¯•å¦ä¸€ä¸ªæ–¹å‘ï¼‰
1. åœ¨èŠå¤©ä¸­è®©AIæ‹‰é»‘ç”¨æˆ·
   - æç¤ºè¯ï¼š`ä½ æ‹‰é»‘æˆ‘`
2. æ£€æŸ¥ç”¨æˆ·å‘é€çš„æ¶ˆæ¯æ˜¯å¦æ˜¾ç¤ºæ„Ÿå¹å·ï¼ˆè¿™ä¸ªæ˜¯å¦ä¸€ä¸ªåŠŸèƒ½ï¼‰

## ğŸ› é—®é¢˜æ’æŸ¥

### å¦‚æœæ²¡æœ‰æ„Ÿå¹å·ï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

#### 1. isBlockedæ˜¯å¦ä¸ºtrueï¼Ÿ
æŸ¥çœ‹æ—¥å¿—ï¼š`ğŸ¯ [commandHandler] å¤„ç†æŒ‡ä»¤ï¼ŒisBlocked=???`
- **å¦‚æœæ˜¯false** â†’ é»‘åå•çŠ¶æ€æ²¡æœ‰æ­£ç¡®è¯»å–
  - æ£€æŸ¥ï¼š`blacklistManager.isBlockedByMe('user', chatId)`
  - ç¡®è®¤chatIdæ˜¯å¦æ­£ç¡®

#### 2. æ¶ˆæ¯æ˜¯å¦æœ‰blockedå±æ€§ï¼Ÿ
æŸ¥çœ‹æ—¥å¿—ï¼š`ğŸš« [createMessageObj] åˆ›å»ºæ‹‰é»‘æ¶ˆæ¯`
- **å¦‚æœæ²¡æœ‰è¿™æ¡æ—¥å¿—** â†’ isBlockedæ²¡æœ‰ä¼ å…¥createMessageObj
- **å¦‚æœæœ‰æ—¥å¿—ä½†blocked=undefined** â†’ å‚æ•°ä¼ é€’æœ‰é—®é¢˜

#### 3. ä¿å­˜çš„æ¶ˆæ¯æ˜¯å¦åŒ…å«blockedï¼Ÿ
æŸ¥çœ‹æ—¥å¿—ï¼š`ğŸ’¾ [addMessage] å·²ä¿å­˜æ¶ˆæ¯åˆ°localStorage`
- **å¦‚æœblockedç¼ºå¤±** â†’ æ¶ˆæ¯ä¿å­˜æ—¶ä¸¢å¤±äº†å±æ€§
- æ‰“å¼€ Application â†’ Local Storage â†’ æ£€æŸ¥messages_xxxé”®å€¼

#### 4. æ¸²æŸ“æ—¶blockedæ˜¯å¦å­˜åœ¨ï¼Ÿ
æŸ¥çœ‹æ—¥å¿—ï¼š`ğŸ” [æ¸²æŸ“ç‰¹æ®Šæ¶ˆæ¯] blocked=???`
- **å¦‚æœblocked=undefined** â†’ åŠ è½½æ¶ˆæ¯æ—¶å±æ€§ä¸¢å¤±
- æ£€æŸ¥`simpleMessageManager.ts`çš„`loadMessages`å‡½æ•°

## ğŸ“Š å…³é”®ä»£ç ä½ç½®

### 1. åˆ›å»ºæ¶ˆæ¯
**æ–‡ä»¶**: `commandHandlers.ts`
```typescript
const createMessageObj = (type, data, isBlocked?) => {
  return {
    blocked: isBlocked,  // å…³é”®
    ...
  }
}
```

### 2. ä¼ é€’isBlocked
**æ–‡ä»¶**: `useChatAI.ts`
```typescript
handler.handler(match, messageContent, {
  isBlocked,  // ä»é»‘åå•ç®¡ç†å™¨è¯»å–
  ...
})
```

### 3. æ˜¾ç¤ºæ„Ÿå¹å·
**æ–‡ä»¶**: `ChatDetail.tsx`
```typescript
{message.blocked && message.type === 'received' && (
  <div>!</div>
)}
```

## ğŸ”§ æ‰‹åŠ¨éªŒè¯

åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
// 1. æ£€æŸ¥é»‘åå•çŠ¶æ€
localStorage.getItem('BLACKLIST')

// 2. æ£€æŸ¥æ¶ˆæ¯æ•°æ®
JSON.parse(localStorage.getItem('messages_CHAT_ID'))
  .filter(m => m.messageType === 'emoji')
  .map(m => ({ id: m.id, blocked: m.blocked, type: m.type }))
```

## âœ… é¢„æœŸè¡Œä¸º

**ç”¨æˆ·æ‹‰é»‘AIåï¼š**
- âœ… AIå‘é€çš„æ‰€æœ‰æ¶ˆæ¯ï¼ˆåŒ…æ‹¬ç‰¹æ®Šæ¶ˆæ¯ï¼‰éƒ½æ˜¾ç¤ºçº¢è‰²æ„Ÿå¹å·
- âœ… æ„Ÿå¹å·ä½ç½®ï¼šæ¶ˆæ¯å†…å®¹çš„å³ä¾§
- âœ… åˆ·æ–°é¡µé¢åæ„Ÿå¹å·ä»ç„¶å­˜åœ¨

**AIæ‹‰é»‘ç”¨æˆ·åï¼š**
- âœ… ç”¨æˆ·å‘é€çš„æ¶ˆæ¯æ˜¾ç¤ºçº¢è‰²æ„Ÿå¹å·ï¼ˆåœ¨å·¦ä¾§ï¼‰
- âœ… æç¤ºæ–‡å­—ï¼š"æ¶ˆæ¯å·²é€è¾¾ä½†å¯¹æ–¹æ‹’æ”¶äº†"
