# 气泡底图功能使用说明

## 🎨 什么是气泡底图？

气泡底图功能允许你上传**不规则形状的图片**（如水彩笔刷、手绘背景等）作为聊天气泡的底图，系统会自动使用**九宫格拉伸技术**让底图适应不同长度的文字内容。

**适用场景**：
- 水彩风格气泡
- 手绘笔触效果
- 纸张撕裂边缘
- 不规则形状背景

---

## 📖 使用教程

### 1. 准备底图

**图片要求**：
- ✅ PNG格式（支持透明背景）
- ✅ 最好有清晰的边缘效果
- ✅ 建议尺寸：200x100 或以上
- ✅ 中间部分设计简单（会被拉伸）

**设计要点**：
```
┌─────────────────────────┐
│ 左边缘 │  中间  │ 右边缘 │  ← 横向会拉伸
│  保持  │ 可拉伸 │  保持  │
└─────────────────────────┘
   ↑        ↑        ↑
  不变形   拉伸    不变形
```

---

### 2. 上传并应用

#### 步骤 1：上传图片
1. 打开气泡编辑器
2. 找到"气泡底图"卡片
3. 点击"选择底图"按钮
4. 选择你的PNG图片

#### 步骤 2：调整参数

**九宫格切片位置（10%-50%）**：
- 控制哪部分是"边缘"，哪部分是"可拉伸区域"
- 数值越大 = 边缘保留越多
- **推荐值**：30%

**内边距（5-50px）**：
- 文字与底图边缘的距离
- 确保文字不会太靠近边缘
- **推荐值**：15px

**拉伸模式**：
- **拉伸（推荐）**：中间部分平滑拉伸
- 重复：中间部分重复平铺
- 圆角重复：智能圆角处理
- 间隔重复：带间距的重复

#### 步骤 3：应用
点击"应用"按钮，底图会自动生效！

---

## 🔧 工作原理

### CSS九宫格技术

```css
.message-bubble {
  /* 底图源 */
  border-image-source: url(你的图片.png);
  
  /* 切片：30%处切开，fill填充内容区 */
  border-image-slice: 30% fill;
  
  /* 边框宽度（内边距）*/
  border-image-width: 15px;
  
  /* 拉伸模式 */
  border-image-repeat: stretch;
  
  /* 必需的透明边框 */
  border: 15px solid transparent;
}
```

### 九宫格分区示意

```
┌────────┬──────────────┬────────┐
│   1    │      2       │   3    │  ← 上边缘
│ 左上角 │   上边       │ 右上角 │
├────────┼──────────────┼────────┤
│   4    │      5       │   6    │  ← 中间行
│ 左边   │  内容区(填充)│ 右边   │  （5会拉伸）
├────────┼──────────────┼────────┤
│   7    │      8       │   9    │  ← 下边缘
│ 左下角 │   下边       │ 右下角 │
└────────┴──────────────┴────────┘
```

**关键点**：
- 区域 1, 3, 7, 9（四个角）**永不变形**
- 区域 2, 4, 6, 8（四条边）根据拉伸模式处理
- 区域 5（中间）自动填充并拉伸

---

## 💡 调参技巧

### 问题1：边缘被拉伸变形
**解决**：增大"九宫格切片位置"
- 从30%调到35%或40%
- 保留更多的边缘区域

### 问题2：文字太靠近边缘
**解决**：增大"内边距"
- 从15px调到20px或更高

### 问题3：中间有重复的图案
**解决**：
1. 切换到"拉伸"模式
2. 或重新设计底图，让中间部分更简单

### 问题4：底图太小/太大
**解决**：
- 底图大小由图片本身决定
- 调整"九宫格切片位置"和"内边距"来适配

---

## 🎯 最佳实践

### 推荐设计流程

1. **设计底图**（Photoshop/Figma）
   - 画一个宽200px、高80px的形状
   - 确保左右两端有20-30px的装饰
   - 中间100px左右设计简单（纯色或简单渐变）

2. **导出PNG**
   - 保存为PNG格式
   - 确保透明背景

3. **上传测试**
   - 上传到气泡编辑器
   - 默认参数先预览
   - 调整切片位置直到满意

4. **保存样式**
   - 点击"保存样式"
   - 给样式命名（如"水彩蓝"）
   - 可随时在样式库加载

---

## 📊 示例对比

### 示例1：水彩笔刷

**图片特点**：
- 左右两端有不规则笔触
- 中间是半透明渐变

**参数设置**：
- 切片位置：35%
- 内边距：18px
- 拉伸模式：拉伸

**效果**：
✅ 边缘笔触保持完整
✅ 中间自然过渡
✅ 短消息和长消息都适用

---

### 示例2：纸张撕裂边缘

**图片特点**：
- 上下边缘有撕裂效果
- 中间是纸张纹理

**参数设置**：
- 切片位置：25%
- 内边距：12px
- 拉伸模式：拉伸

**效果**：
✅ 撕裂边缘不变形
✅ 纸张纹理自然拉伸

---

## ⚠️ 注意事项

1. **圆角问题**
   - 九宫格拉伸不支持`border-radius`
   - 应用底图后会自动移除圆角
   - 如需圆角效果，请在底图设计时添加

2. **背景色问题**
   - 应用底图会自动移除背景色
   - 文字颜色需要手动调整以确保可见

3. **性能问题**
   - 图片太大会影响性能
   - 建议尺寸不超过500x300

4. **兼容性**
   - `border-image`在所有现代浏览器都支持
   - IE不支持

---

## 🎨 创意应用

1. **主题气泡包**
   - 设计一套同风格底图
   - 用户可切换不同主题

2. **节日特效**
   - 圣诞节：雪花边缘
   - 春节：红包效果
   - 情人节：爱心边框

3. **角色定制**
   - 为不同NPC角色设计专属底图
   - 体现角色性格

4. **场景联动**
   - 根据剧情场景切换底图
   - 雨天用水滴效果
   - 晴天用阳光边缘

---

## 🔧 故障排查

### 问题：上传后没反应
- 检查图片格式（必须是PNG/JPG）
- 检查文件大小（不要超过5MB）
- 刷新页面重试

### 问题：预览显示不正确
- 点击"预览"按钮刷新
- 检查是否点击了"应用"按钮
- 清除浏览器缓存

### 问题：导出CSS后无效
- 确保HTML结构匹配
- 检查CSS选择器是否正确
- 确保有`border: Xpx solid transparent;`

---

## 📞 反馈与支持

如遇到问题，请记录：
1. 使用的图片（可截图）
2. 设置的参数
3. 出现的问题
4. 浏览器信息

祝你设计出美丽的气泡！🎉
